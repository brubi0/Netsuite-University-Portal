roubleshooting Workflow Execution-- in this module, we will examine active workflows and workflow history and introduce you to the Workflow Execution Log, a system generated log that tracks all actions and transitions that execute at specific states of a workflow. We will also discuss how to purge workflow history records and disable a workflow's ability to save its execution history information altogether.

In this module, we will discuss the following topics-- viewing active workflows and workflow history; reading the workflow execution log; purging workflow history records; and disabling execution history. Upon the completion of this module, you will be able to use active workflows to identify workflow instances currently running on a particular record type; use workflow history to identify the individual states visited by each workflow instance; use the workflow execution log to troubleshoot action and transition execution in individual states of the workflow; explain the process of purging workflow history records and the benefits of periodically doing so; and explain each of the workflow execution history options in the KEEP INSTANCE AND HISTORY dropdown list and when you would select each option.

When a workflow is initiated on a record, NetSuite tracks the processing activity of each running workflow and logs the workflow's processing history on the record, showing the individual states and actions executed at each state. This information can be useful when troubleshooting the execution order of actions, and the triggers responsible for executing those actions. NetSuite displays all workflow activity processing on a record in the active workflows and workflow history sublists.

By default, active workflows and workflow history are displayed as separate sublists under a system information subtab when viewing or editing a record. If you want to group them as sublists under a Workflow subtab, modify the custom record and enable allow attachments or show notes. Active workflows shows all current workflow instances running on a particular record. Workflows that have completed processing on the record will be automatically removed from this list. This is common with single state workflows and workflows with no non-exiting end states.

To view a list of active workflows, select a record that the workflow is running on and click on the active workflows sublist. In the example shown here, you can see that there are currently three workflow instances running on this performance review record. Each of these workflows are listed because they have been configured to not exit once all actions in the workflow have been processed.

We will discuss non-existing end states in the next module. Workflow history displays each state entered during workflow execution, including current and past state transitions. All state transitions stay on this sublist for the life of the record, or until you purge workflow history records. When you delete or rename a state in the Workflow Manager, the workflow history sublist automatically reflects the changes to the state in the state name info column. It also displays the value of workflow and state fields set during workflow execution and provides a link to the workflow execution log, which displays even more detailed workflow execution information.

This example represents the workflow history associated with the running workflows we just discussed in active workflows. Workflow history lists the individual states visited during the processing of each workflow instance. In this case, entry and load are displaying state 1 data entry and state 1 record load respectively.

Each of these states represent the entry states for each of those workflows. Notice that the Save workflow is displaying each of its four visited states as well, indicating that the workflow successfully transitioned from state 0 to state 1 to state 2 and finally to state 3.

In addition to disabling and purging workflow history, you can also suspend a workflow's execution entirely by setting the workflow's release status to suspended. When a workflow is suspended, no new instances of the workflow will be initiated. No existing workflow instances will be triggered. No new workflow execution log entries will be created.

No scheduled actions or transitions will be executed. The workflow cannot be initiated or executed from SuiteScript. And current instances of a suspended workflow can be canceled. Suspended workflows can still be edited in the Workflow Manager however. To resume a workflow's normal processing, set the release status to testing or released.

It's important to note that disabling the SuiteFlow feature altogether does not suspend workflows currently running on records. The workflow history sublist provides administrator access to the workflow execution log, which is a system generated log that tracks all actions and transitions executed on a record for each state in a workflow.

You can use the workflow execution log to debug and troubleshoot workflows running on a record. When troubleshooting workflow execution, the workflow execution log can be used to determine which actions and transitions did or did not execute. It could be used to determine the order in which actions and transitions were actually executed. And it allows you to view server-side state generated errors.

It's important to note that client-side errors are not logged in the workflow execution log. Workflow logging is not enabled by default for new workflows created in SuiteFlow. To enable workflow logging, check the enable logging option on the workflow definition page as shown here. By default, all new workflows will have a release status of testing, which only allows administrators or the workflow owner to execute the workflow.

The workflow execution log will only be available when all of the following are true-- when the current user is logged in as an administrator, when the workflow has a release status of testing or released, and when the enabled logging checkbox is enabled. Workflows with a status of testing or released that do not have enabled logging enabled will display the log link and workflow history, but the log will not contain any entries.

Selecting a status of testing will automatically check the enabled logging checkbox. But selecting a status of released, will not automatically enable logging for the workflow. This is by design as the primary purpose of the workflow execution log is to test and troubleshoot workflows. So it makes sense to turn logging on when in a testing status.

Switching a workflow status from testing to released and then back to testing, will only log entries during the time the workflow was set to testing. To access the workflow execution log, view or edit a record in NetSuite that currently has, or has had a workflow executing on it. Select the workflow history sublist. And then click on the log link next to the state entry you want to view. NetSuite displays all log entries for the selected state in a new window.

In this example, the state selected how to send email action configured to execute at after record submit. The condition checks to see whether there is an email address for the subordinate and the user sending the email. In this case, the condition validates to true, and the workflow continues.

An email notification is sent from the user, Larry Nelson in this case, to the subordinate, James Rawlings, and the workflow transitions to state 3. Notice the send Email actions from and to entries in the log. The minus 5 and 640 entries represent each user's employee ID on their employee record.

In this example, minus 5 just happens to be Larry Nelson and 640 is James Rawlings. Let's take a closer look at how to read the workflow execution log. The workflow history sublist shown here lists several performance review workflows executing on a new performance review record.

The workflow execution order, while not necessarily sequential, is as follows-- entry, load, save, and approval. The entry and load workflows are both single state workflows. And the save and approval workflows are multi-state workflows. Let's examine each of the logs associated with each workflow and state and discuss what some of the entries mean. This is also an excellent example of the workflow trigger execution sequence in action.

Let's start with the entry workflow. Since client-side events are not logged, the execution log for this single state workflow only displays the trigger events that occurred during workflow processing, but not the individual actions processed. You can clearly see the workflow is being initiated at before-record load upon the creation of a new record, as indicated by the event and context entries. When the record is saved, the active trigger automatically shifts to before record submit, and then to after record submit if there are no record validation errors before being committed to the database.

The last before record load entry is the result of the go to record action in state 3 of the Save workflow, which we'll see in just a moment. This action causes a new performance review record to be created and loaded into the browser in edit mode. The load workflow is also a single state workflow, but it contains a combination of client-side and server-side actions.

The log entries are similar to the entries in the entry workflow. The workflow is initiated at before record load upon the creation of a new performance review record. Upon entry into the workflow, there are two actions executed, one that populates the review type field and another that sets the rating code field as mandatory. When the record is saved, the active trigger shifts from before record load to before record submit and then to after record submit.

Once the record has been successfully saved to the database and subsequently viewed or edited, it is reloaded into the browser at before record load. And additional actions are executed that ensure action display persistence. You can also see the configured event types selected for a couple of these actions.

The Saved workflow is a multi-state workflow consisting of four processing states, each performing a specific bit of record processing. State 0 performs a validation on the rating code field. State 1 creates a new related task record. State 2 sends an email notification. And state 3 navigates the user to a new record form displayed in edit mode.

State 0 is the entry state of the workflow. You can see that the active trigger entering this workflow is before record submit, which indicates that the workflow is being initiated in the saved context only. The first action processed in state 0 is a validation on the rating code field. In this entry, the validation succeeded and thus returns false. The action processing completes at before record submit. And the record automatically shifts to a post save after record submit context before finally transitioning to state one.

The first thing that you should look for whenever there is a multi-state workflow executing on a Save event is a change in the active workflow trigger on the transition from one state to another. In this case, the active trigger coming into state 1 is after record submit. This shift from before record submit to after record submit was configured on the transition itself. The reason, the create record action will only execute at after record submit. In this example, you can clearly see the successful creation of the related task record and the record subsequent transition to state 2.

Like the Create record action in state 1, to send email action is only supported at after record submit. Since there was no change in the active trigger between state 1 and state 2, the Send Email action is executed. In this example, the email was sent from an administrator, Larry Nelson, whose ID is minus 5, to recipient Baruch Simmons, who has employee ID 1257. And you can see that the record automatically transitioned from state 2 to state 3.

The final state of the Save workflow contains a single go to record action that navigates the user to a new custom performance review record. Once again, go to record is only supported at after record submit, which just so happens to be the incoming trigger to state 3. The action is executed and the record is loaded into the browser. This completes the log entries for the Save workflow.

Finally, the approval workflow is executed and the record enters the workflow's entry state, which sets the value of a custom workflow field to the current approver. In this example, ID 953 is employee manager, Fiona Small. As you can see, there are no further log entries for this record, since the approval workflow is sitting in its entry state waiting for Fiona Small to approve or reject the record. Once approval is provided, the workflow will continue processing and additional log entries will be generated.

Some workflow actions guarded by conditions may not display in the logs when the conditions evaluate false. The general idea being that if no action is executed, there is no need to log it. However, viewing these considered actions can be useful when verifying the actions conditions themselves.

If you suspect there are considered but not executed actions in a particular log, enable the show rejected actions and transitions option. In this example, from state 0 of the Save workflow, we can see a considered but not executed return user error action being evaluated on record save.

The rating code field is being evaluated to ensure the value entered is either A, B, or C. In this case, a valid value was entered by the user. So the condition evaluates false. And there is no reason to execute the return user error action.

It is not until runtime that the system can determine whether an action or transition will execute based on their configured triggers, such as before record submit and after record submit. When an action selected trigger is not valid based on the active workflow trigger, the log will display these actions as skipped. In this example, before record submit is the active trigger coming into the state.

There was a go-to-action action configured to execute on before record submit. However, before record submit is not a supported trigger for the go-to-record action. So the action is skipped. It's also important to note that skipped actions do not generate user facing errors. You can only see them in the workflow execution log.

Action details are also recorded in the Workflow Execution Log. NetSuite field IDs will be displayed in the log and UI label names to identify fields such as title and company. These are the IDs that show in field level help when clicking on a field's label, provided show internal IDs is enabled in your User Preferences.

The values shown for list record fields refer to record internal IDs. If you want to verify the data in the created task record in this particular example, you could open the task record in the user interface whose internal ID is 434.

Every time a workflow transitions to a new state, including workflow entry states, workflow history records are created on the record on which the workflow is executing. Over time, the number of workflow history records can become quite large and can negatively impact workflow performance. To improve overall performance, you can purge these workflow history records as needed.

In this example, we can see workflow history records showing the workflows and associated states visited during workflow processing. To support the purge of workflow history records, SuiteFlow provides an instances and history records dialogue that allows workflow administrators to view workflow history statistics and initiate the deletion of history records' unfinished workflow instances.

Using the workflow history records' statistics dialog box, you can view the number of records that currently have active workflow instances running on them and initiate purge requests based on the length of time they have been stored. It's important to note that purging workflow history records has no effect on the update history entries listed in the history subtab of the workflow definition page. The instances in history records dialogue can be accessed by selecting instances in history records from the More link in the upper right corner of the workflow definition page. The history records on active workflows field represents the number of history records currently active for the selected workflow.

History records' unfinished workflows represents the number of history records across all completed workflow instances. In the Delete section, the Delete history records unfinished workflows older than represents the age in months of the history records you want to purge for the selected workflow. This deletes all history records older than the value entered while retaining the newest entries. The default is three months. To delete all history records for the workflow, enter 0.

When purging workflow history records, the purge process is run as a background task in NetSuite. When requesting multiple purges, only one purge task can run at the time in your account. But each additional purge request will be cued and processed accordingly.

During the purge process, there is no impact on currently processing workflows or future workflow development in SuiteFlow. And the purge could be canceled at any point in time from the instances in history records dialogue. When purging workflow history, only completed workflow instances and their associated workflow execution log entries will be deleted.

In addition to purging workflow history, a workflow's execution history can be disabled on a per workflow basis by selecting an option from the keep instance and history dropdown list on the workflow definition page. The ability to disable execution history for select Workflows improves workflow performance, particularly on workflows running on transaction records by turning off instances in history gathering for select Workflows, which reduces overall database usage.

Let's review the options on the keep instance in history dropdown list. Selecting always preserves all existing instances of finished workflows and related history entries. Selecting only when testing preserves all existing instances of finished workflows and related history entries, but only when the release status is set to testing.

Selecting never deletes all workflow instances with history entries when the workflow reaches its final end state, at which point, no new workflow instances or related history entries will be saved. And any old instance and related history entries saved prior to workflow execution history being disabled will still be available.

Here are some key things to remember when troubleshooting workflow execution. The active workflows sublist lists all currently running workflows on the current record. The workflow history sublist provides workflow execution information such as the workflows executed and the individual states visited by each workflow. It also provides administrator access to the workflow execution log. The workflow execution log can be used to learn how workflows execute.

For example, if you are not seeing unexpected behavior, check the log to see if an action was skipped. The log will immediately identify skipped actions such as attempting to execute a send email action on an unsupported server trigger. Only server-side action execution is logged in the workflow execution log. Client-side actions are not logged.

When updating a workflow's release status to released, uncheck enable logging to reduce unnecessary logging in production environments. Checking enable logging and setting the release status to released, generates all the typical logs accessible in workflow history. Workflow execution can be suspended by setting the workflow's release status to suspended. When logging is turned off, error logs are still generated but only for server-side errors, not event-based errors generated from the user interface.

And finally, here are some key things to remember when purging workflow history records. The instances and history records dialogue can be accessed in both view and edit modes by clicking on the More link in the upper right corner of the Workflow Manager. Only one purge can be run at a time. If another purge is requested while a previous purge is still processing, it will be queued until the currently running purge completes.

The purge process can be canceled after it is initiated. However, records that have already been purged cannot be recovered. Depending on the number of history records, it could take a significant amount of time for workflow history records to be purged. When a purge completes, an email is sent to the user that initiated the purge, and all purge events will be logged on the workflow definition page on the History subtab as an edit event.

It is now time for you to complete the required hands-on exercises associated with the topics discussed in this module. To complete the required exercises, refer to your student workbook. When you have finished, you may continue with the next module. This concludes the Troubleshooting Workflow Execution module.