Working with Sub-Workflows. In this module, we will continue our modular approach to workflow development as we discuss sub-workflows, where apparent workflow initiates one or more child workflows. We'll also discuss some important design considerations associated with the configuration of sub-workflows, such as loose versus tight coupling and parallel processing.

In this module, we will discuss the following topics-- understanding sub-workflows, sub-workflow design considerations, and synchronous versus asynchronous sub-workflow processing. Upon the completion of this module, you will be able to explain how sub-workflows can be used to reduce workflow complexity, use modular workflow design techniques to sequence the execution order of multiple sub-workflows, and use modular workflow design techniques to implement sub-workflows supporting parallel approvals.

A sub-workflow is a child business process initiated by a parent workflow that may or may not be dependent upon the completion of the child workflow to complete its own processing. Sub-workflows can be created to meet very complex business requirements without adding unnecessary complexity to existing workflows already running on records. Sub-workflows can be dependent upon their initiating parent workflow, such as when you want to perform some action or transition in the parent workflow based on a value returned to the parent by the workflow.

Sub-workflows can also be independent of their initiating parent, such as when the child sub-workflow has no direct impact on the initiating parent workflow from a processing perspective. In both of these situations, you end up with multiple workflows running concurrently on a single record or in parallel with each other. The initiate workflow action is used to initiate a sub-workflow from a parent workflow. This allows you to process multiple workflows in parallel.

The sub-workflow must be configured on the same base record as the initiating parent workflow. For example, if the parent workflow is running on a purchase order record, the initiated sub-workflow must also be configured to run on the purchase order record. One of the primary design approaches used by workflow developers is componentization, in which complex workflows are broken up into smaller components for the purpose of reducing complexity of any single workflow resulting in easier maintenance.

You might split a business process into separate workflows running on the same record type for the following reasons. You have multiple workflows that perform distinct record processing and you want to have those workflows processed in a specific order. Or when portions of a business process need to be running in parallel. There are several workflow design approaches that allow you to achieve either of these two use cases-- sequential processing, using either loose or tight coupling, and parallel processing.

We'll also discuss the concept of parallel approvals where all approvals in both the parent and child workflows must be completed before a final approval can be granted. Let's look at each of these sub-workflow design approaches starting with sequential processing using loose coupling. Loose coupling is a software development term where one component is not dependent on any other component.

For example, in the diagram shown here, workflow X initiates both workflow A and workflow B, but each workflow process is independently from the other. A loose coupling approach allows two or more sub-workflows to be initiated and sequenced in a specific order.

Here, workflow X represents the initiating parent workflow containing very little business processing logic of its own. It's sole purpose is to initiate sub-workflows A and B. An initiate workflow action in State 1 of workflow x initiates sub-workflow A. And a second initiate workflow action in State 2 initiates sub-workflow B.

Unlike loose coupling, where each workflow is processed independently and asynchronously from one another, tight coupling creates processing dependencies between workflows. Like loose coupling, however, tight coupling still allows you to sequence two or more sub-workflows in a specific order. Consider the diagram shown here.

Workflow X represents the initiating workflow containing its own business processing logic. Workflow's A and B represents sub-workflows also containing their own unique business processing logic. Workflow X and sub-workflows A and B have processing dependencies.

Workflow X and sub-workflow B are both dependent on the processing in sub-workflow A. If sub-workflow A does not complete its processing, processing in workflow x may be affected. The transition between State 1 and State 2 will not be executed. And sub-workflow B will never be initiated.

Parallel processing allows two or more workflows as part of a larger parent business process to run concurrently or in parallel with other workflows on a record. In the example shown here, some workflows A and B represent two separate business processes initiated in parallel with workflow X. Workflow X initiates both workflows asynchronously and waits for each workflow to complete before continuing its own processing in State 4.

When configuring parallel processing use cases, keep in mind that SuiteFlow is unable to detect the completion of more than one sub-workflow at a time. Therefore, you must check for the completion of one workflow in one state and then transition to another state to check for the completion of another sub-workflow.

Finally, let's look at an example of a situation where two workflows are not only running in parallel with each other, but also include parallel approvals where both approvers must approve before the record can reach a final approval state in the initiating workflow. In this example, sub-workflow A is initiated in State 2 of parent workflow X. The first approver, approver A, either approves or rejects the record in State 3. If approved, the record moves to State 4 and evaluates the status of the approval process in sub-workflow A. If rejected, the record moves to State 6 immediately.

The second approver, approver B, approves or rejects the record in sub-workflow A in parallel with approver A in workflow X. If rejected the record moves to State 3. If approved, the record moves to State 4. And finally, in State 4 of parent workflow X, the approval status of the record in sub-workflow A is evaluated. If approved, the record moves to State 5 and is granted final approval. If rejected, the record moves to State six 6 regardless of whether approve A approved the record or not.

The initiate workflow action can be configured to initiate sub-workflows either synchronously or asynchronously. This behavior is configured in the initiate workflow action transition condition using the Wait For Workflow and Wait For Workflow State drop-down list shown here. If specified, the sub-workflow is initiated synchronously. If a workflow and state are not selected, the sub-workflow is initiated asynchronously.

In a synchronous configuration, the parent workflow must wait until the sub-workflow has completed processing before it can transition to the next state in the workflow. In an asynchronous configuration, the parent workflow does not have to wait to transition to the next state of the workflow. Here are some things to keep in mind when working with sub-workflows.

First, don't try to do too much in any one workflow. Consider the nature of the processing performed by each workflow and modularize as necessary. As a general rule, creating multiple workflows that process records in smaller chunks is better from a performance perspective. Separate workflow processing between client triggered and server triggered initiation and action and transition execution. This allows for easier troubleshooting by isolating client-side processing from server-side processing.

Test sub-workflow processing as a standalone workflow before integrating them as a sub-workflow. And sub-workflows can be initiated either synchronously or asynchronously by specifying the Wait For Workflow and Wait For Workflow State fields in the Conditions section of the initiate workflow action configuration.

In this walkthrough demonstration, we will show you how to sequence the performance review save and performance review approval workflows by initiating them as sub-workflows. Specifically, we'll demonstrate the following tasks. First, we'll create the initiating parent workflow. And then we'll configure the necessary initiate workflow actions. And then we'll configure our transitions based on sub-workflow completion using synchronous processing.

We'll begin this walk through demonstration by creating the initiating parent workflow. So let's just go up and navigate to our list of workflows. And I'm just going to go ahead and create a new one right from the start here. And I'm going to go ahead and give this workflow the name of Performance Review Create 05 for Module 5.

I'll also go ahead in following best practices enter in a valid ID for this particular workflow, perf_rev_create. My record type is going to be, of course, performance review. And I'm going to set the release status to Release. Now, normally I'd leave that at testing. But I'm just kind of skipping ahead here just for argument's sake just to put that in the release status. In case there were other users that were going to be initiating this workflow, we want to make sure that they have the opportunity to do so. So we've got that at release.

We're going to go ahead and enable login just so we can check our logs if we need to. And down here in the initiation and event definition section, we are going to leave this at Event Based. And I'm going to go ahead and check the On Create event definition. So we only want this to initiate and kick off our sub-workflows during the initial creation of a new performance review record.

And the trigger type that we're going to use is going to be Before Record Submit, OK. And that's to ensure that our rating code validation that's executing on the performance review save workflow actually processes successfully.

So I'm going to go ahead and save that configuration. And here is my new workflow. And I'm just going to go ahead and add a new state. We are going to have two states for this workflow. Just as you'll see, one state is going to initiate our save workflow. And the second state's going to initiate our approval workflow.

So let me just go ahead and drag a transition between those. And let me just do some basic configuration. What I'm going to do is just double click on State 1. And I'm simply going to rename this Initiate Save Process. And I'm going to do the same for State 2, I'm going to call this Initiate Approval Process.

Now, one thing you'll notice that I'll point out is I do have the option of checking the Do Not Exit Workflow checkbox here on State number 2. However, if I enable this option and I actually call a sub-workflow that has a do not exit workflow enabled in one of its end states, that's going to prevent the sub-workflow from returning itself back to or communicating back to the parent workflow, which can actually hang up workflow processing. So be very careful with the do not exit workflow checkboxes in sub-workflows, as it can cause your parent workflows to hang if it's expecting a return response from those sub-workflows.

In this case, I'm going to go ahead and leave that unchecked. And I'm just going to go ahead and click Save there. Now, what we're going to do is go ahead and configure our individual actions. So in State 1, I'm simply going to go ahead and add an Initiate Workflow action that initiates the performance review Save Workflow. So I'm going to come down here to initiate workflow. And I'm going to select Performance Review Save. And that's all I'm going to do right there.

There we go. You can see my action in the context panel. And I'm going to do the exact same thing over here in State 2, except I'm going to initiate our approval workflow. So pretty simple to configure on the surface here. There it is, performance review approval. OK, we'll show you any workflow fields that are in that workflow. There we go.

Now, as we mentioned, we do want to actually configure the transition so it only transitions when the Save Workflow has actually completed. So we want to make sure that our performance review save workflow actually completes all of its processing before making the transition to State 2 and initiating the approval workflow. So how are we going to do that?

Well, what we need to do is we need to call the Save Workflow synchronously. So how do we do that? I'm simply going to Select the transition, Edit the transition. And then come right over here and say I want to wait for the Save Workflow to finish processing. And specifically, I want to wait for State 3 Go to New Record to complete processing before returning to the parent workflow and making this transition. And that is how you configure synchronous sub-workflow processing.

So let's go ahead and Save that. There we go. I'll click it Done Editing. And all I'm going to do is go out and Create a new performance review record now. And we'll take a look at workflow history. And you should see exactly how the sequential processing actually worked. So let's go ahead and do that.

I'm going to go to Lists, Custom Performance Review, New. I'm going to call this Module 5 Test number 1. We'll go ahead and choose John Rittman as our subordinate. We'll give him a rating code of B. There we go. And I'll go ahead and Save that.

All right, there we go. And going to my list of performance review records, I can see my new record right up here. Let's just go ahead and view that and take a look at what we have in workflow history. So if I come over here, look at workflow history, OK, you can see that it did, in fact, process the workflows as you would expect. You can see it initiated the Save Workflow right here. OK, oh, actually you know what happened?

There's something very interesting that happened here. I just realized I forgot to do something. And this is a really interesting point. I'm kind of glad this actually happened. Notice that I'm getting the Save Workflow getting kicked off here, OK? And then I have my Create Workflow that's kicking off the Save Workflow as well, OK?

So there's some redundancy happening here. All right, what I want to do is this. Let me return to my workflows just for a moment here. And let me go ahead and edit my performance review create 05 workflow. I'm sorry, not that one. I'm sorry.

Let me go back to my Save Workflow. And remember that this workflow is already being initiated by virtue of the fact that we're creating a new performance review record. So what I'm going to do is simply edit this Save Workflow And I'm going to remove the On Create event definition selection here. OK, so that way the only way this Save Workflow is going to be initiated is by my parent Create 05 Workflow.

I'll Save that. And I'll do the same thing for my approval workflow as well. I always seem to forget to do that when I demo this. It's very easy to forget to do, but it's a good learning experience when it does happen because it just reminds you. There we go. And we'll save that.

Now, let me go back to my list of performance review records. I'm just going to get rid of this record here just for a moment. We'll just add a new one. And I'll actually even give it the exact same name, Module 5 Test number 1. Once again, I'll choose John Rittman as my subordinate. Rating code B. So on and so forth.

Let's go ahead and get that record saved. And now let's take a look and see what we have in our workflow history. OK, now you'll see very different order of operations here in the workflow history here. You can see we have our entry and load workflows. But notice that save did not get initiated until after Create 05. And that's really what we're looking for here. We initiate Create 05.

And if I look at the log file for that entry, you can see that all it really did was kick off the initiate workflow action to initiate the performance review save workflow. And then it basically finished and then it transitioned to State 2 where it initiated the approval workflow. So we can clearly see everything happening here. Notice it returns back to the parent workflow here. And then it initiates the approval workflow.

So you can see everything happening. As you would expect, sequential processing, save processing first, finishing with State 3, returning its state back to the parent, and then initiating the approval workflow. So that's just a really basic example of sequential processing using a tight coupling approach since we are forcing that transition on the completion of the Save Workflow. And you're going to do something very similar in your first exercise in your student exercises. And then you're going to get into some more complex sub-workflow design configurations that will kind of challenge your understanding of some of these concepts that we've discussed.

It is now time for you to complete the required hands on exercises associated with the topics discussed in this module. To complete the required exercises, refer to your Student Workbook. When you have finished, you may continue with the next module. In Exercise 1, you will design a sub-workflow supporting sequential processing of the furniture request save and approval workflows using a loose coupling approach. Its sequence is the execution of the furniture request save workflow, which executes first, and the furniture request approval workflow, which executes second.

First, you will create the initiating or parent workflow with two states called furniture request create. That does not have much business logic other than controlling the initiation of sub-workflows and what to do when they are completed. State 1 of the furniture request create workflow will initiate the furniture request save workflow on the record. Once the furniture request save workflow has completed, a transition moves the record to State 2, at which time the furniture request approval workflow will be initiated.

Exercises 2 and 3 will walk you through the creation of a second approval workflow called Contract Review, which will be initiated using the initiate workflow action from the furniture request approval workflow. This configuration represents parallel processing using a tight coupling approach, where final supervisory approval is dependent on the approval of the contract review. Approvals in both workflows can happen at any time. But final approval of the record cannot take place until the contract review workflow has landed in one of its two end states.

The process begins with the standard supervisory approval of the furniture request. If rejected, the workflow transitions directly to State 3. If approved and there are no more approvers in the hierarchy, the workflow transitions to State 1B, where conditions are evaluated to determine the outcome of the contract review workflow.

The configuration of the transitions out of State 1B are based on the final end state of the contract review sub-workflow. This requires both Wait for Workflow and Wait for Workflow State Fields to be configured on each transition. The dashed line returning to furniture request approval represents the different end states and the resulting transitions in the approval workflow. Click anywhere to continue.

This concludes the Working with Sub-Workflows Module.